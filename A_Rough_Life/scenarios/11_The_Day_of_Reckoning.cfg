#textdomain wesnoth-A_Rough_Life
[scenario]
    name= _ "The Day of Reckoning"
    id=11_The_Day_of_Reckoning
    next_scenario=12_Flip_of_Destiny
    victory_when_enemies_defeated=no

    [story]
        [part]
            story= _ "This was it."
        [/part]
        [part]
            background="story/arl-5a.jpg"
            story= _ "Jacques followed the King and the remaining soldiers ever deeper down the cave, until they came to a makeshift encampment at the edge of a wide corridor. Jacques wondered what waited for them at the other side. At the very end, there would be Ruphulus, but Jacques didn't even want to imagine how many bones of his minions they would have to crack to get to him."
        [/part]
        [part]
            story= _ "Along the way, the King and Kyoko were deep in conversation, with the King stealing a glance now and then towards the book that Kyoko grasped firmly in her hands. Curious though he was, he knew the book was not his riddle to solve, as he was not the one who first heard its call."
        [/part]
        [part]
            story= _ "As they reached the encampment, Jacques immediately set off to examine the troops and boost their confidence. This was the time they both dreaded and hoped for - the time of reckoning, when they could settle the score with their evil adversary and truly break his chains."
        [/part]
        [part]
            story= _ "This was it."
        [/part]
    [/story]

    map_data="{~add-ons/A_Rough_Life/maps/reckoning.map}"
    {INTRO_AND_SCENARIO_MUSIC loyalists.ogg battle.ogg}
    {EXTRA_SCENARIO_MUSIC vengeful.ogg}
    {EXTRA_SCENARIO_MUSIC the_city_falls.ogg}
    turns=-1

    {UNDERGROUND}

    [side]
        side=1
        controller=human
        id=Jacques
        name= _ "Fierce Jacques"
        type=Battle Commander
        fog=no
        shroud=yes
        canrecruit=yes
        recruit=Orcish Grunt,Saurian Augur,Spearman,Thug,Elvish Archer,Sergeant
        {GOLD 200 150 100}
        {INCOME 12 9 6}
        team_name=Jacques
        user_team_name= _ "Jacques"
        village_gold=1
    [/side]

    [side]
        side=2
        type=Dragon Lord
        id=Ruphulus
        name= _ "Ruphulus"
        profile="portraits/dragon_head.png"
        canrecruit=yes
        gold=0
        income=0
        [ai]
            {AI_SIMPLE_ALWAYS_ASPECT aggression 1}
            {AI_SIMPLE_ALWAYS_ASPECT caution 0}
            {AI_SIMPLE_ALWAYS_ASPECT passive_leader yes}
            {AI_SIMPLE_ALWAYS_ASPECT grouping no}
            {AI_SIMPLE_ALWAYS_ASPECT village_value 1}
            {AI_SIMPLE_ALWAYS_ASPECT leader_value 3}
        [/ai]
        {ai/aliases/stable_singleplayer.cfg}
        team_name=Ruphulus
        user_team_name= _ "Ruphulus"
    [/side]

    [side]
        side=3
        type=Death Knight
        id=Dark Knight
        name= _ "Dark Knight"
        canrecruit=yes
        recruit=Deathblade,Revenant,Bone Shooter,Banebow
        {GOLD 60 80 100}
        {INCOME 2 3 4}
        [ai]
            {AI_SIMPLE_ALWAYS_ASPECT aggression 0.5}
            {AI_SIMPLE_ALWAYS_ASPECT caution 0}
            {AI_SIMPLE_ALWAYS_ASPECT passive_leader yes}
            {AI_SIMPLE_ALWAYS_ASPECT grouping no}
            {AI_SIMPLE_ALWAYS_ASPECT village_value 1}
            {AI_SIMPLE_ALWAYS_ASPECT leader_value 3}
        [/ai]
        {ai/aliases/stable_singleplayer.cfg}
        team_name=Ruphulus
        user_team_name= _ "Undead"
    [/side]

    [side]
        side=4
        type=Death Knight
        id=Blood Knight
        name= _ "Blood Knight"
        canrecruit=yes
        recruit=Deathblade,Revenant,Bone Shooter,Banebow
        {GOLD 60 80 100}
        {INCOME 2 3 4}
        [ai]
            {AI_SIMPLE_ALWAYS_ASPECT aggression 0.5}
            {AI_SIMPLE_ALWAYS_ASPECT caution 0}
            {AI_SIMPLE_ALWAYS_ASPECT passive_leader yes}
            {AI_SIMPLE_ALWAYS_ASPECT grouping no}
            {AI_SIMPLE_ALWAYS_ASPECT village_value 1}
            {AI_SIMPLE_ALWAYS_ASPECT leader_value 3}
        [/ai]
        {ai/aliases/stable_singleplayer.cfg}
        team_name=Ruphulus
        user_team_name= _ "Undead"
    [/side]

    [side]
        side=5
        type=Draug
        id=Bone Marshall
        name= _ "Bone Marshall"
        canrecruit=yes
        recruit=Skeleton,Skeleton Archer,Vampire Bat
        {GOLD 90 120 150}
        {INCOME 4 6 8}
        [ai]
            {AI_SIMPLE_ALWAYS_ASPECT aggression 0.5}
            {AI_SIMPLE_ALWAYS_ASPECT caution 0}
            {AI_SIMPLE_ALWAYS_ASPECT passive_leader yes}
            {AI_SIMPLE_ALWAYS_ASPECT grouping no}
            {AI_SIMPLE_ALWAYS_ASPECT village_value 1}
            {AI_SIMPLE_ALWAYS_ASPECT leader_value 3}
        [/ai]
        {ai/aliases/stable_singleplayer.cfg}
        team_name=Ruphulus
        user_team_name= _ "Undead"
    [/side]

    [side]
        side=6
        type=Skeletal Dragon
        id=Pet of Death
        name= _ "Pet of Death"
        canrecruit=yes
        recruit=Chocobone,Deathblade,Revenant,Bone Shooter,Skeleton,Skeleton Archer
        {GOLD 100 140 180}
        {INCOME 5 7 9}
        [ai]
            {AI_SIMPLE_ALWAYS_ASPECT aggression 0.5}
            {AI_SIMPLE_ALWAYS_ASPECT caution 0}
            {AI_SIMPLE_ALWAYS_ASPECT passive_leader yes}
            {AI_SIMPLE_ALWAYS_ASPECT grouping no}
            {AI_SIMPLE_ALWAYS_ASPECT village_value 1}
            {AI_SIMPLE_ALWAYS_ASPECT leader_value 3}
        [/ai]
        {ai/aliases/stable_singleplayer.cfg}
        team_name=Ruphulus
        user_team_name= _ "Undead"
    [/side]

    [side]
        side=7
        type=Ancient Lich
        id=Counsellor of Death
        name= _ "Counsellor of Death"
        profile="portraits/lich-servant.png"
        canrecruit=yes
        recruit=Lich,Chocobone,Deathblade,Revenant,Banebow,Skeleton,Skeleton Archer
        {GOLD 100 140 180}
        {INCOME 5 7 9}
        [ai]
            {AI_SIMPLE_ALWAYS_ASPECT aggression 0.5}
            {AI_SIMPLE_ALWAYS_ASPECT caution 0}
            {AI_SIMPLE_ALWAYS_ASPECT passive_leader yes}
            {AI_SIMPLE_ALWAYS_ASPECT grouping no}
            {AI_SIMPLE_ALWAYS_ASPECT village_value 1}
            {AI_SIMPLE_ALWAYS_ASPECT leader_value 3}
        [/ai]
        {ai/aliases/stable_singleplayer.cfg}
        team_name=Ruphulus
        user_team_name= _ "Undead"
    [/side]

    [side]
        side=8
        type=Skeleton Guardian left
        id=Fear
        name= _ "Fear"
        canrecruit=yes
        gold=0
        income=0
        [ai]
            {AI_SIMPLE_ALWAYS_ASPECT aggression 0.5}
            {AI_SIMPLE_ALWAYS_ASPECT caution 0}
            {AI_SIMPLE_ALWAYS_ASPECT passive_leader yes}
            {AI_SIMPLE_ALWAYS_ASPECT grouping no}
            {AI_SIMPLE_ALWAYS_ASPECT village_value 1}
            {AI_SIMPLE_ALWAYS_ASPECT leader_value 3}
        [/ai]
        {ai/aliases/stable_singleplayer.cfg}
        team_name=Ruphulus
        user_team_name= _ "Undead"
    [/side]

    [side]
        side=9
        type=Skeleton Guardian right
        id=Loathing
        name= _ "Loathing"
        canrecruit=yes
        gold=0
        income=0
        [ai]
            {AI_SIMPLE_ALWAYS_ASPECT aggression 0.5}
            {AI_SIMPLE_ALWAYS_ASPECT caution 0}
            {AI_SIMPLE_ALWAYS_ASPECT passive_leader yes}
            {AI_SIMPLE_ALWAYS_ASPECT grouping no}
            {AI_SIMPLE_ALWAYS_ASPECT village_value 1}
            {AI_SIMPLE_ALWAYS_ASPECT leader_value 3}
        [/ai]
        {ai/aliases/stable_singleplayer.cfg}
        team_name=Ruphulus
        user_team_name= _ "Undead"
    [/side]

    [event]
        name=prestart
        [objectives]
            side=1
            [objective]
                description= _ "Defeat Ruphulus."
                condition=win
            [/objective]
            [objective]
                description= _ "Death of Jacques or Kyoko or turns run out."
                condition=lose
            [/objective]
            [gold_carryover]
                bonus=yes
                carryover_percentage=10
            [/gold_carryover]
        [/objectives]
        {RECALL_LOYALS_AND_KYOKO}
        [recall]
            id=King Bombasan
        [/recall]
        #added x,y because if the player has all his/her loyal units the two dwarves were recalled in lava.
        [recall]
            id=Semper
            x,y=19,38
        [/recall]
        [recall]
            id=Fi
            x,y=21,38
        [/recall]

        [item]
            x,y=7,37
            image=scenery/oak-leaning.png
        [/item]
        [item]
            x,y=18,30
            image=items/dragonstatue.png
        [/item]
        [item]
            x,y=22,30
            image=items/dragonstatue.png
        [/item]
        [item]
            x,y=18,24
            image=scenery/signpost.png
        [/item]
        [item]
            x,y=8,28
            image=scenery/signpost.png
        [/item]
        [item]
            x,y=20,21
            image=items/burial.png
        [/item]
        [item]
            x,y=22,21
            image=items/burial.png
        [/item]
        [item]
            x,y=40,18
            image=items/bones.png
        [/item]
        [item]
            x,y=30,12
            image=items/bonestack.png
        [/item]
        [item]
            x,y=11,2
            image=items/bones.png
        [/item]
        [item]
            x,y=12,1
            image=items/bones.png
        [/item]
        [item]
            x,y=12,2
            image=items/bones.png
        [/item]
        [item]
            x,y=1,1
            image=items/altar-evil.png
        [/item]
        [item]
            x,y=7,1
            image=items/altar-evil.png
        [/item]
        [item]
            x,y=1,4
            image=items/burial.png
        [/item]
        [item]
            x,y=7,4
            image=items/burial.png
        [/item]
        [item]
            x,y=1,7
            image=items/burial.png
        [/item]
        [item]
            x,y=7,7
            image=items/burial.png
        [/item]
        {MODIFY_UNIT id=Jacques name _"Fierce Jacques"}
    [/event]

    [event]
        name=start

        {CLEAR_VARIABLE Jacques_store}
        {CLEAR_VARIABLE Ruphulus_store}
        {CLEAR_VARIABLE transition}
        {VARIABLE Fear_and_Loathing 0}
        {VARIABLE bridges_built 0}
        {VARIABLE Krug 0}
        {VARIABLE Bombasan_dead 0}
        {VARIABLE Kyoko_knows 0}

        {STORE_UNIT_VAR id=Jacques type Jacques_type}
        [switch]
            variable=Jacques_type
            [case]
                value=Thief
                [set_variable]
                    name=transition
                    value=1
                [/set_variable]
                [message]
                    speaker=narrator
                    message= _ "Albeit he has led his troops all the way to the final battle, Jacques can hardly bear to look them in their eyes. He has personally survived this far only by hiding behind the shoulders of others more steadfast than him and by sending others to do his share of the fighting. If he does not prove himself in battle soon, his good standing may be lost forever."
                    image=wesnoth-icon.png
                [/message]
                {MODIFY_UNIT id=Jacques advances_to (Sand Trapper)}
            [/case]
            [case]
                value=Sand Trapper
                [set_variable]
                    name=transition
                    value=2
                [/set_variable]
                [message]
                    speaker=narrator
                    message= _ "Looking at the soldiers and trusty friends around him, Jacques sees several that he thinks would be better fit to lead this expedition than him. Sure, he has taken a blow here or a cut there, but mostly he personally has stayed out of harm's way. He knows he should lead by example, and is determined to make it so this time around."
                    image=wesnoth-icon.png
                [/message]
                {MODIFY_UNIT id=Jacques advances_to (Battle Commander)}
            [/case]
        [/switch]
        {CLEAR_VARIABLE Jacques_type}

        [message]
            speaker=narrator
            message= _ "As the troops get ready for the assault, Jacques signals that they should wait just a little while longer. He hopes that Kyoko might be able to decipher whatever help the words in the Book of Prophecies may be able to give them."
            image=wesnoth-icon.png
        [/message]
        [message]
            speaker=narrator
            message= _ "After several fruitless attempts, Kyoko tries yet again to concentrate and opens the book. And again, she is not drawn inside and shown images, but rather served what seems a trite old saying: 'Bridges are burnt when friendships end, and not before a few bones are broken will new ones be built.'"
            image=wesnoth-icon.png
        [/message]
        [message]
            speaker=Kyoko
            message= _ "I do not care about bridges! How do we defeat Ruphulus, that is all I would know. What is the fate that we may impose on him?"
        [/message]
        [message]
            speaker=narrator
            message= _ "As she speaks up, the words in the book change. Now, the message reads: 'She who would travel in a straight line shall find no end, but she who will find the time to lean to one side may see better that which awaits.'"
            image=wesnoth-icon.png
        [/message]
        [message]
            speaker=Jacques
            message= _ "Kyoko? Any luck?"
        [/message]
        [message]
            speaker=Kyoko
            message= _ "I'm afraid not, although I do believe the book is trying to tell me something, but it is a message I do not fully understand. Perhaps it's simply that this is not the best place to consult the Book."
        [/message]
        [message]
            speaker=Jacques
            message= _ "If not here, then where? For I fear that nothing good lies up ahead."
        [/message]
        [message]
            speaker=King Bombasan
            message= _ "Things are as they are, and we can't help them. Perhaps the chance for miracles will still come. In the meantime, however, we should worry about the enemy's forces getting too big. I fear we have no time to waste."
        [/message]
        [message]
            speaker=Jacques
            message= _ "You are right, of course. Friends, comrades, onwards, and may open skies smile upon us once more!"
        [/message]
        [set_recruit]
            recruit=Orcish Grunt,Saurian Augur,Spearman,Thug,Elvish Archer
            side=1
        [/set_recruit]
        [if]
            [variable]
                name=dwarves
                equals=1
            [/variable]
            [then]
                [allow_recruit]
                    side=1
                    type=Dwarvish Fighter,Dwarvish Guardsman,Dwarvish Thunderer,Dwarvish Scout
                [/allow_recruit]
            [/then]
        [/if]
    [/event]

    [event]
        name=turn 2
        [message]
            speaker=Loathing
            message= _ "Damn this sentry duty! I simply loathe staring down eerie corridors. What about you, brother?"
        [/message]
        [message]
            speaker=Fear
            message= _ "I don't like it, either, makes me afraid of what might come up."
        [/message]
        [message]
            speaker=Loathing
            message= _ "Hey! Do I see someone approaching? Heavens help me if it's those loathsome dwarves again!"
        [/message]
        [message]
            speaker=Fear
            message= _ "Don't frighten me like that! I'm sure it's just some travelers lost on their way, looking for a place to lay down their weary bones."
        [/message]
        [message]
            speaker=Jacques
            message= _ "We will indeed be laying down some weary bones, but not our own!"
        [/message]
    [/event]

    [event]
        name=turn 3
        [switch]
            variable=Fear_and_Loathing
            [case]
                value=0
                [message]
                    speaker=Fear
                    message= _ "Loathing, brother, where are thou?"
                [/message]
                [message]
                    speaker=Loathing
                    message= _ "I'm here, brother, don't be afraid."
                [/message]
                [message]
                    speaker=Fear
                    message= _ "Do you think there's any chance that these creatures will leave us alone?"
                [/message]
                [message]
                    speaker=Loathing
                    message= _ "I only know that I would hate it if they didn't."
                [/message]
            [/case]
            [case]
                value=1
                [message]
                    speaker=Loathing
                    message= _ "You killed my brother!"
                [/message]
                [message]
                    speaker=Loathing
                    message= _ "If only I could, I'd send you to your unfortunate fate to meet him again!"
                [/message]
            [/case]
            [case]
                value=2
                [message]
                    speaker=Fear
                    message= _ "Loathing, brother, where are thou? What have you done to him? Why are his bones no longer moving?"
                [/message]
                [message]
                    speaker=Fear
                    message= _ "I suppose there's no way we could talk this through, is there?"
                [/message]
            [/case]
        [/switch]
    [/event]

    [event]
        name=turn 4
        [switch]
            variable=Fear_and_Loathing
            [case]
                value=0
                [message]
                    speaker=Fear
                    message= _ "Are we still here?"
                [/message]
                [message]
                    speaker=Loathing
                    message= _ "My my, they go about their business very slowly, don't they?"
                [/message]
                [message]
                    speaker=Fear
                    message= _ "One wonders if they'll ever get to the end at this rate."
                [/message]
                [message]
                    speaker=Loathing
                    message= _ "Perhaps that big stony fellow will want to help them to speed things up."
                [/message]
            [/case]
            [case]
                value=1
                [message]
                    speaker=Loathing
                    message= _ "You killed my brother!"
                [/message]
                [message]
                    speaker=Loathing
                    message= _ "If only I could, I'd send you to your unfortunate fate to meet him again!"
                [/message]
            [/case]
            [case]
                value=2
                [message]
                    speaker=Fear
                    message= _ "Loathing, brother, where are thou? What have you done to him? Why are his bones no longer moving?"
                [/message]
                [message]
                    speaker=Fear
                    message= _ "I suppose there's no way we could talk this through, is there?"
                [/message]
            [/case]
        [/switch]
    [/event]

    [event]
        name=last breath
        [filter]
            id=Fear
        [/filter]
        [message]
            speaker=Fear
            message= _ "What... what is this feeling? Suddenly, I... I feel no fear..."
        [/message]
        [set_variable]
            name=Fear_and_Loathing
            add=1
        [/set_variable]
        [if]
            [variable]
                name=Fear_and_Loathing
                equals=3
            [/variable]
            [then]
                [message]
                    speaker=Jacques
                    message= _ "Odd and pitiful creatures, the pair of them. I hope they indeed find their rest beyond death and undeath... And now, onwards, friends, onwards!"
                [/message]
            [/then]
        [/if]
    [/event]

    [event]
        name=last breath
        [filter]
            id=Loathing
        [/filter]
        [message]
            speaker=Loathing

            message= _ "Have I indeed been killed... yet again? Oh no, don't worry, I do not loathe you. Finally, I'm free..."
        [/message]
        [set_variable]
            name=Fear_and_Loathing
            add=2
        [/set_variable]
        [if]
            [variable]
                name=Fear_and_Loathing
                equals=3
            [/variable]
            [then]
                [message]
                    speaker=Jacques
                    message= _ "Odd and pitiful creatures, the pair of them. I hope they indeed find their rest beyond death and undeath... And now, onwards, friends, onwards!"
                [/message]
            [/then]
        [/if]
    [/event]

    [event]
        name=post_advance
        first_time_only=no
        [filter]
            id=Jacques
        [/filter]
        [switch]
            variable=transition
            [case]
                value=2
                [message]
                    speaker=narrator
                    message= _ "Jacques realizes that the shadow no longer frightens him. He is calm and determined. His troops around him are reinvigorated and fight on with new purpose. The dark night seems a little brighter. He has become a true commander."
                    image=wesnoth-icon.png
                [/message]
                [set_variable]
                    name=transition
                    add=1
                [/set_variable]
            [/case]
            [case]
                value=1
                [message]
                    speaker=narrator
                    message= _ "Finally, Jacques feels that he has set on the road to reaching his full potential, but he still has some way to go."
                    image=wesnoth-icon.png
                [/message]
                [set_variable]
                    name=transition
                    add=1
                [/set_variable]
                {MODIFY_UNIT id=Jacques advances_to (Battle Commander)}
            [/case]
        [/switch]
    [/event]

    [event]
        name=moveto
        first_time_only=no
        [filter]
            side=1
            x,y=18,24
        [/filter]
        [message]
            speaker=narrator
            message= _ "Forbidden entry! By order of the Dragon Lord!"
            image=wesnoth-icon.png
        [/message]
    [/event]

    [event]
        name=moveto
        [filter]
            side=1
            x,y=8,28
        [/filter]
        [message]
            speaker=narrator
            message= _ "Rule number 1 states: Obey orders or die! And you didn't obey orders..."
            image=wesnoth-icon.png
        [/message]
        [unit]
            side=2
            type=Revenant
            x,y=8,29
        [/unit]
        [unit]
            side=2
            type=Skeleton
            x,y=8,26
        [/unit]
        [unit]
            side=2
            type=Skeleton Archer
            x,y=10,29
        [/unit]
    [/event]

    [event]
        name=moveto
        [filter]
            side=1
            x,y=1-16,34-40
        [/filter]
        [remove_shroud]
            side=1
            x,y=0-17,33-41
        [/remove_shroud]
        [message]
            speaker=unit
            message= _ "What a calm, peaceful place! I wonder why it has been put here?"
        [/message]
    [/event]

    [event]
        name=moveto
        [filter]
            id=Kyoko
            x,y=1-16,34-40
        [/filter]
        [message]
            speaker=Kyoko
            message= _ "Yes, I think I was right in coming here in order to consult the book. Now just to find the proper place..."
        [/message]
    [/event]

    [event]
        name=moveto
        [filter]
            id=Kyoko
            x,y=7,37
        [/filter]
        [message]
            speaker=Kyoko
            message= _ "A little island with an oak tree leaning to one side! I think I found the proper place, it's so calm, so soothing. Why did such a monster as Ruphulus create this place?"
        [/message]
        [message]
            speaker=narrator
            message= _ "As Kyoko leans against a tree, she almost wishes she could stay here forever. It is a place which does her extremely well, and she has an eerie feeling she knows why. She opens the Book of Prophecies. This time, she is absorbed into the Book anew, and her head feels with images."
            image=wesnoth-icon.png
        [/message]
        [message]
            speaker=narrator
            message= _ "First, she sees herself, singing a song during the last celebrations of her father's birthday, as the vision pans to show Ruphulus watching her with a gleam in his eyes. What disturbs her is that there is lust, yes, but also something more. Was it genuine affection?"
            image=wesnoth-icon.png
        [/message]
        [message]
            speaker=narrator
            message= _ "Then, she sees herself collapsed on the floor, as Ruphulus gently picks her up, carries her down a corridor and transforms into a dragon. So it was his own wings she heard flapping that night! He lifts her up in the air and flies towards the mountains, but then he doesn't drop her by accident as she first thought. She sees the dragon circle for awhile, until he spots a young wose approaching an oasis. Swiftly the dragon swoops down and then places Kyoko in the shrub. He lifts again and watches from afar as the wose stumbles upon the young maiden, then flies away."
            image=wesnoth-icon.png
        [/message]
        [if]
            [variable]
                name=Kyoko_safe
                equals=1
            [/variable]
            [then]
                [message]
                    speaker=narrator
                    message= _ "Finally, she is shown images from the battle that day when they confronted the evil mage and he transformed into the dragon before their very eyes. Mighty was his rage, but not towards Kyoko, whom he did his utmost to spare."
                    image=wesnoth-icon.png
                [/message]
            [/then]
        [/if]
        [message]
            speaker=narrator
            message= _ "Kyoko wonders why she is being shown the images from the past, until she realizes their significance. The evil mage is in love with her! That is why he could not bring himself to do her harm, and that was why he accosted her that time when he lured her into his chambers. She realizes that this is also the reason for the creation of this very place: he has created it for her, as a haven for her to relax in and enjoy."
            image=wesnoth-icon.png
        [/message]
        [message]
            speaker=narrator
            message= _ "With this awareness, she is swept into the Book once more, and shown the image of herself, walking across a bridge, broken and unbroken, towards a dragon. But, and that puzzles her, she is not full of anger, she does not wield her staff in combat. No, she is smiling, and she opens her arms as if she wanted to embrace the big dragon. The dragon seems puzzled and looks at her with its big, expectant, hopeful eyes."
            image=wesnoth-icon.png
        [/message]
        [message]
            speaker=narrator
            message= _ "Kyoko is puzzled by this image. And then it becomes clear to her. Life is not fair, Luxor said. This, as she has come to realize, is a truth that cuts both ways. Finally, she knows what she has to do."
            image=wesnoth-icon.png
        [/message]
        [set_variable]
            name=Kyoko_knows
            add=1
        [/set_variable]
    [/event]

    [event]
        name=die
        [filter]
            id=Kyoko
        [/filter]
        [message]
            speaker=narrator
            message= _ "The Princess fought like a valiant fighter worthy of her dwarvish ancestry and breezed through the enemy ranks with speed worthy of her elven one. And yet, she could not escape or overcome the adversary that struck her down..."
            image=wesnoth-icon.png
        [/message]
        [endlevel]
            result=defeat
        [/endlevel]
    [/event]

    [event]
        name=last breath
        first_time_only=no
        [filter]
            id=Ruphulus
        [/filter]
        [message]
            id=Ruphulus
            message= _ "Hahaha! You think your puny little swords and arrows can kill me?"
            image="portraits/dragon_body.png"
        [/message]
        [message]
            speaker=narrator
            message= _ "Just when they think they have the Dragon defeated, Ruphulus rises in front of them again, fully healed."
            image=wesnoth-icon.png
        [/message]
        {FULL_HEAL (id=Ruphulus)}
    [/event]

    [event]
        name=moveto
        [filter]
            side=1
            x,y=29,10
        [/filter]
        {TELEPORT_TILE 29 10 28 10}
        [unit]
            type=Great Troll
            id=Krug
            name= _ "Krug"
            profile="portraits/troll-Krug.png"
            side=8
            x,y=29,10
        [/unit]
        [message]
            speaker=Krug
            # wmllint: local spelling bonehea
            message= _ "You haven't had enough yet, have you? Well, Krug can always enlarge that bone stack at the bottom of the mountain. You bonehea... Hey! This one has some meat still left on its bones - how can that be?"
        [/message]
        [message]
            x,y=28,10
            message= _ "Huh? We thought nobody but the undead could be found here. I gather you are not a minion of Ruphulus, are you?"
        [/message]
        [message]
            speaker=Krug
            message= _ "Meat on its bones, and it talks like it does not care for those stupid old boneheads. Reminds Krug of that crazy explorer, it does. Hmmm... Who is this weakling?"
        [/message]
        [message]
            x,y=28,10
            message= _ "We have come with King Bombasan to defeat Ruphulus and his army, and to liberate these caves once more!"
        [/message]
        [message]
            speaker=Krug
            message= _ "Ha! Liberate, weaklings says. Would they have the caves liberated of Krug, as well?"
        [/message]
        [message]
            x,y=28,10
            message= _ "Only if you wanted to attack us and invade our own lands further up towards the surface."
        [/message]
        [message]
            speaker=Krug
            message= _ "The surface, ha! The surface is for weaklings. Krug is perfectly happy here, if only the pesky bones would not disturb him."
        [/message]
        [message]
            x,y=28,10
            message= _ "Then it seems we may have a common purpose - we don't like them either. Would you join us in our fight against them?"
        [/message]
        [message]
            speaker=Krug
            message= _ "And be rid of them, and have the peace and quiet once more? Yes, Krug would like that, so Krug joins you."
        [/message]
        [modify_unit]
            [filter]
                id=Krug
            [/filter]
            side=1
        [/modify_unit]
        [set_variable]
            name=Krug
            add=1
        [/set_variable]
    [/event]

    [event]
        name=moveto
        [filter]
            side=1
            x,y=40,20
        [/filter]
        [message]
            speaker=narrator
            message= _ "The hut is empty, but there is something strange about it. It is not as barren as the others, and has garments and strange equipment that surely would not be used by the minions of Ruphulus. It seems deserted now, but who had lived here?"
            image=wesnoth-icon.png
        [/message]
    [/event]

    [event]
        name=moveto
        [filter]
            side=1
            x,y=40,18
        [/filter]
        [message]
            speaker=narrator
            message= _ "You stumble upon a dead body that is different from the other sights of scattered bones. It seems that the person died relatively recently. Scattered around the body, you find various instruments and maps of the area."
            image=wesnoth-icon.png
        [/message]
        [if]
            [variable]
                name=Krug
                equals=1
            [/variable]
            [then]
                [message]
                    speaker=Jacques
                    message= _ "Perhaps this is the explorer that Krug mentioned when we first came across him!"
                [/message]
            [/then]
        [/if]
        [message]
            speaker=narrator
            message= _ "They pick up and consult the maps. As they do so, the layout of this part of the cave system becomes much clearer."
            image=wesnoth-icon.png
        [/message]
        [remove_shroud]
            side=1
            x,y=9-41,0-22
        [/remove_shroud]
    [/event]

    [event]
        name=last breath
        [filter]
            id=Bone Marshall
        [/filter]
        [message]
            speaker=Bone Marshall
            message= _ "Damn you, you fools. I have let the King down, and the path that leads to him has become a little clearer. But be warned, for there are adversaries much stronger than me that you would have to overcome to get to him, and you shall not succeed!"
        [/message]
        {MODIFY_TERRAIN Qxu^Bs| 4 9}
        [set_variable]
            name=bridges_built
            add=1
        [/set_variable]
    [/event]

    [event]
        name=last breath
        [filter]
            id=Pet of Death
        [/filter]
        [message]
            speaker=Pet of Death
            message= _ "Arghh, I failed, and another stone is added to the bridge that you must cross. But still, you won't succeed!"
        [/message]
        {MODIFY_TERRAIN Qxu^Bs| 4 7}
        [set_variable]
            name=bridges_built
            add=1
        [/set_variable]
    [/event]

    [event]
        name=sighted
        [filter]
            id=Counsellor of Death
        [/filter]
        [filter_second]
            side=1
        [/filter_second]
        [message]
            speaker=Counsellor of Death
            message= _ "I see we have some uninvited visitors, busybodies sticking their noses where they don't belong!"
        [/message]
        [message]
            speaker=Counsellor of Death
            message= _ "Busybodies, haha! I will indeed find good use for your bodies, once they lay sprawled beneath my feet!"
        [/message]
    [/event]

    [event]
        name=last breath
        [filter]
            id=Counsellor of Death
        [/filter]
        [message]
            speaker=Counsellor of Death
            message= _ "Hahahaha, you may have defeated me and got yet one more step closer to the Dragon Lord, but so much the worse for you, for who wants to feel the wrath of Death itself?"
        [/message]
        {MODIFY_TERRAIN Qxu^Bs| 4 5}
        [set_variable]
            name=bridges_built
            add=1
        [/set_variable]
    [/event]

    [event]
        name=moveto
        first_time_only=no
        [filter]
            id=Kyoko
            x,y=2-6,4-11
        [/filter]
        [if]
            [variable]
                name=Kyoko_knows
                equals=1
            [/variable]
            [then]
                [if]
                    [variable]
                        name=bridges_built
                        equals=3
                    [/variable]
                    [then]
                        [message]
                            speaker=narrator
                            message= _ "As Kyoko steps into the chamber of the Dragon, she yells out for everyone to stop fighting. In bewilderment, those who hear her command obey."
                            image=wesnoth-icon.png
                        [/message]
                        [message]
                            speaker=Kyoko
                            message= _ "I need to speak to Ruphulus. Alone."
                        [/message]
                        [message]
                            speaker=Jacques
                            message= _ "No, Kyoko! Don't do it. There is no need to. We can beat the Dragon!"
                        [/message]
                        [message]
                            speaker=Kyoko
                            message= _ "Shush, brute! What needs to be done needs to be done. Besides, it's not only that I need to do it, I want to."
                        [/message]
                        [message]
                            speaker=narrator
                            message= _ "Jacques cannot comprehend it. Was she able to consult the Book? What did she see? Must she really sacrifice herself in order to save the others? He knows he cannot stop her, so along with the others he steps aside and lets her do whatever it is she needs to do."
                            image=wesnoth-icon.png
                        [/message]
                        [if]
                            [have_unit]
                                x,y=4,4
                            [/have_unit]
                            [then]
                                {TELEPORT_TILE 4 4 4 15}
                            [/then]
                        [/if]
                        [message]
                            speaker=narrator
                            message= _ "The Dragon is just as perplexed as she approaches him. He looks at her with unsure eyes, as she smiles reassuringly."
                            image=wesnoth-icon.png
                        [/message]
                        [music]
                            name=elvish-theme.ogg
                            immediate=yes
                        [/music]
                        [message]
                            speaker=Kyoko
                            message= _ "It is beautiful. The little haven you built for me, it's truly beautiful."
                        [/message]
                        [message]
                            speaker=Ruphulus
                            message= _ "It is?"
                        [/message]
                        [message]
                            speaker=narrator
                            message= _ "The Dragon wavers, unsure what to think of it."
                            image=wesnoth-icon.png
                        [/message]
                        [message]
                            speaker=Kyoko
                            message= _ "Yes, it is. I never thought you had such beauty in you. Why didn't you show it to me earlier?"
                        [/message]
                        [message]
                            speaker=Ruphulus
                            message= _ "I... I... wanted to, but I never really got the chance. When it was done, I tried to invite you to see it, but you turned me down, remember? It still hurts when I think of that moment."
                        [/message]
                        [message]
                            speaker=Kyoko
                            message= _ "I do, of course I do. I didn't like being accosted like that. But had I known you had such a thing of beauty waiting for me, I would behave differently. Sorry I kicked you."
                        [/message]
                        [message]
                            speaker=narrator
                            message= _ "As she speaks, Kyoko approaches the Dragon who is becoming visibly agitated."
                            image=wesnoth-icon.png
                        [/message]
                        {TELEPORT_UNIT (
                            id=Kyoko
                        ) 4 4}
                        [message]
                            speaker=Kyoko
                            message= _ "I'm sorry it turned out like that. Oh, Ruphulus, have I driven you to become a dragon? Can you never be the same old Ruphulus again? I would so much like to apologize to the man I once knew."
                        [/message]
                        [message]
                            speaker=Ruphulus
                            message= _ "Wait, my dear Kyoko. This is but one impenetrable shell that I use, but the old Ruphulus is still inside. Here he is, as eager to talk to you as you are to him."
                        [/message]

                        [sound]
                            name=lightning.ogg
                        [/sound]
                        {FLASH_WHITE ()}

                        [store_unit]
                            [filter]
                                id=Ruphulus
                            [/filter]
                            variable=Ruphulus_store
                        [/store_unit]
                        {VARIABLE Ruphulus_store.type (Arch Mage)}
                        {VARIABLE Ruphulus_store.experience 0}
                        [unstore_unit]
                            variable=Ruphulus_store
                        [/unstore_unit]
                        {FULL_HEAL (id=Ruphulus)}
                        {CLEAR_VARIABLE Ruphulus_store}

                        [message]
                            speaker=narrator
                            message= _ "With a flash, the dragon is transformed into the old mage in his human form once more. Mighty though he is, his chin and hands shake as he looks at Kyoko coming ever nearer."
                            image=wesnoth-icon.png
                        [/message]
                        [message]
                            speaker=Kyoko
                            message= _ "Oh, Ruphulus, it's so nice to see you again. What horrors have been transpiring to me, you would never know. Can you help, can you make it stop?"
                        [/message]
                        [message]
                            speaker=narrator
                            message= _ "With these words, Kyoko throws herself at Ruphulus and flings her arms around him in embrace. The old mage seems to be at a loss for words as he tries to console her."
                            image=wesnoth-icon.png
                        [/message]
                        [message]
                            speaker=Ruphulus
                            # wmllint: local spelling advers
                            message= _ "What do you mean, help? I can make your life wonderful, and make you the queen of the world. As soon as we defeat the advers..."
                            image="portraits/Ruphulus.png"
                        [/message]
                        [message]
                            speaker=narrator
                            message= _ "As the old mage speaks with tremor in his heart and mind, he fails to notice the imperceptible movement of Kyoko's hand as it reaches for a secret dagger and stabs the mage in the neck. The mage is cut off in the middle of the sentence and looks at Kyoko with puzzled eyes."
                            image=wesnoth-icon.png
                        [/message]
                        [message]
                            speaker=Ruphulus
                            # wmllint: local spelling wha-at Di
                            message= _ "Wha-at? Di.. did you stab me? Oh, the pain... What is this warmth spilling down my neck? Is it my blood? Why is it suddenly becoming so cold? Are you cold, dear Kyoko? Can you see me? All is dark. I am dark... I... I deserve to die... I lo..."
                            image="portraits/Ruphulus.png"
                        [/message]
                        [message]
                            speaker=narrator
                            message= _ "As life's energy slowly sips out of the old mage, Kyoko can do nothing but watch. Sure, he was an evil man who wished nothing but destruction upon the world. And yet, she could not help but feel saddened by what she has done, betraying a man's - albeit an evil's man - love to bring about his end."
                            image=wesnoth-icon.png
                        [/message]
                        [message]
                            speaker=narrator
                            message= _ "As Ruphulus finally collapses to the floor, dead, nothing unusual happens. There is no lightning bolt, no dragon reappears, no cry of desperation is heard from around the cave. Still, with most of the sorcerer's minions already defeated, it doesn't take long for Jacques and his troops to secure the caves and make sure that the undead menace is no more."
                            image=wesnoth-icon.png
                        [/message]
                        [kill]
                            id=Krug
                        [/kill]
                        [kill]
                            id=King Bombasan
                        [/kill]
                        [endlevel]
                            result=victory
                            bonus=yes
                            {NEW_GOLD_CARRYOVER 10}
                        [/endlevel]
                    [/then]
                    [else]
                        [message]
                            speaker=Kyoko
                            message= _ "I know what I need to do, but I still need to be able to even get to Ruphulus to do it."
                        [/message]
                    [/else]
                [/if]
            [/then]
            [else]
                [message]
                    speaker=Kyoko
                    message= _ "I know I can bring this to an end, somehow, but where will I learn how?"
                [/message]
            [/else]
        [/if]
    [/event]

    [event]
        name=die
        [filter]
            id=Jacques
        [/filter]
        [message]
            speaker=narrator
            message= _ "Leading his forces valiantly into battle, Jacques wants to lead by example and plunges into the thick of the struggle. Suddenly, he realizes that he is losing strength and that he has gone too far ahead to benefit from the defense of his troops. He stands for as long as he can, but the swarms of enemies finally overcome him."
            image=wesnoth-icon.png
        [/message]
        [endlevel]
            result=defeat
        [/endlevel]
    [/event]

    [event]
        name=die
        [filter]
            id=King Bombasan
        [/filter]
        [message]
            speaker=narrator
            message= _ "The King fights like he is a young man again. His runic hammer is music to his soldiers' ears as it cracks against the undead skulls, and each strike sends another message of light and hope as it shatters their enemies' bones. Still, the King is not a young man, and his powers slowly desert him. He fights on, ever weaker, until a blow is struck over his head that he can no longer deflect. The King is no more."
            image=wesnoth-icon.png
        [/message]
        [message]
            speaker=narrator
            message= _ "But the soldiers do not despair. No, they see Jacques leading them into battle and they are determined to fight on ever more bravely, to pay tribute to the valiant King and his honorable deeds at this dark time."
            image=wesnoth-icon.png
        [/message]
        [set_variable]
            name=Bombasan_dead
            add=1
        [/set_variable]
    [/event]

    [event]
        name=time over
        [message]
            speaker=narrator
            message= _ "Jacques and his soldiers tried their best, and for a long time it seemed they stood a chance against the dragon. And yet, their forces dwindled down just as the Dragon unleashed a new wave of undead upon them, and they were overcome."
            image=wesnoth-icon.png
        [/message]
        [endlevel]
            result=defeat
        [/endlevel]
    [/event]
[/scenario]
